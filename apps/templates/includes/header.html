<header class="header-global">
    <nav id="navbar-main" aria-label="Primary navigation" class="navbar navbar-main navbar-expand-lg navbar-theme-primary pt-4 navbar-dark">
        <div class="container position-relative">
            <div class="navbar-collapse collapse me-auto" id="navbar_global">
                <div class="navbar-collapse-header">
                    <div class="row">
                        <div class="col-6 collapse-brand">
                            <a href="/">
                                <img src="/static/assets/img/brand/light.svg" alt="ArtCollab logo">
                            </a>
                        </div>
                        <div class="col-6 collapse-close">
                            <a href="#navbar_global" class="fas fa-times" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" title="close" aria-label="Toggle navigation"></a>
                        </div>
                    </div>
                </div>
                <ul class="navbar-nav navbar-nav-hover align-items-lg-center">
                    <li class="nav-item me-2">
                        <a href="index.html" class="nav-link">Acceuil</a>
                    </li>
                    <li class="nav-item me-2">
                        <a href="{% url 'book_list' %}" class="nav-link">Bibliothèque</a>
                    </li>
                </ul>
            </div>

            <!-- Search & Buttons -->
            <div class="d-flex align-items-center ms-auto">

                <!-- Search Form -->
                <form class="navbar-search form-inline me-md-3" id="navbar-search-main" autocomplete="off">
                    <div class="input-group input-group-merge search-bar">
                        <span class="input-group-text" id="topbar-addon">
                            <!-- search icon SVG -->
                        </span>
                        <input type="text" class="form-control" id="topbarInputIconLeft" placeholder="Search" aria-label="Search" aria-describedby="topbar-addon">
                        <div id="search-results" class="dropdown-menu"></div>
                    </div>
                </form>

                <a href="{% url 'all_books' %}" class="btn btn-outline-white d-inline-flex align-items-center me-md-3 btn-glow">
                    <!-- Library SVG -->
                    Explorer la bibliothèque
                </a>
                <a href="{% url 'cart_user_view' %}" class="btn-glow d-inline-flex align-items-center me-md-3">
                    <i class="fas fa-shopping-cart"></i>
                </a>
                <a href="{% url 'view_favorites' %}" class="btn-glow d-inline-flex align-items-center me-md-3">
                    <i class="fas fa-heart"></i>
                </a>
                <a href="{% url 'logout' %}" class="btn btn-secondary btn-sm d-inline-flex align-items-center">
                    Sign Out
                </a>
            </div>
        </div>
    </nav>
</header>

<style>
.header-global {
    position: absolute;
    top: 0;
    width: 100%;
    z-index: 10;
    background: transparent;
}

.navbar-nav .nav-link {
    font-weight: 500;
    transition: 0.3s;
}

.navbar-nav .nav-link:hover {
    color: #FFD700 !important;
}

.search-bar {
    position: relative;
    overflow: visible;
    border: 1px solid #000000;
    border-radius: 0.25rem;
}

#search-results {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    max-height: 300px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #000000;
    border-radius: 0.25rem;
    display: none;
    z-index: 2000; 
}

.dropdown-item:hover {
    background-color: #f0f0f0;
    cursor: pointer;
}

/* ===== Corrige le bouton panier ===== */
.btn-glow {
    background-color: rgba(255, 255, 255, 0.15); /* léger fond clair */
    border-radius: 0.25rem;
    padding: 0.5rem;
}

.btn-glow i.fas.fa-shopping-cart {
    color: #fff;  /* blanc pour contraster */
    font-size: 1.25rem;
}
</style>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('topbarInputIconLeft');
    const resultsDropdown = document.getElementById('search-results');

    if (!searchInput || !resultsDropdown) return;

    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        if (query.length < 2) {
            resultsDropdown.style.display = 'none';
            return;
        }

        fetch(`/search/?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                console.log('Search results:', data); // check results
                resultsDropdown.innerHTML = '';

                if (data.results.length > 0) {
                    data.results.forEach(item => {
                        const a = document.createElement('a');
                        a.href = item.url;
                        a.className = 'dropdown-item';
                        if(item.type === 'User') {
                            a.innerHTML = `<i class="fa fa-user"></i> ${item.name}`;
                        } else {
                            a.innerHTML = `<i class="fa fa-book"></i> ${item.name}`;
                        }
                        resultsDropdown.appendChild(a);
                    });
                } else {
                    const span = document.createElement('span');
                    span.className = 'dropdown-item text-muted';
                    span.innerText = 'No results found';
                    resultsDropdown.appendChild(span);
                }

                resultsDropdown.style.display = 'block';
            })
            .catch(err => {
                console.error('Search error:', err);
                resultsDropdown.style.display = 'none';
            });
    });

    // Hide dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !resultsDropdown.contains(e.target)) {
            resultsDropdown.style.display = 'none';
        }
    });
});
</script>
