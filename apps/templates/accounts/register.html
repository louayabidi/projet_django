{% extends "layouts/base-fullscreen.html" %}

{% block title %}Sign UP{% endblock %}

{% block stylesheets %}
<style>
/* Animation de fond dynamique avec livres */
.fullscreen-bg {
    background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
    background-size: 400% 400%;
    animation: gradient 15s ease infinite;
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: auto; /* Permet le scroll */
    padding: 2rem 1rem; /* Espacement pour le scroll */
}

/* Animation du dégradé */
@keyframes gradient {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

/* Livres flottants animés */
.floating-books {
    position: fixed; /* Fixe pour rester en arrière-plan pendant le scroll */
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 1;
    overflow: hidden;
}

.book {
    position: absolute;
    font-size: 2rem; /* Taille réduite */
    opacity: 0.1;
    animation: floatBook 20s infinite linear;
    color: rgba(255, 255, 255, 0.3);
}

@keyframes floatBook {
    0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
    }
    10% {
        opacity: 0.3;
    }
    90% {
        opacity: 0.3;
    }
    100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
    }
}

/* Boîte du formulaire compacte */
.form-container {
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    border-radius: 16px;
    padding: 2rem; /* Padding réduit */
    width: 100%;
    max-width: 420px; /* Largeur réduite */
    max-height: 85vh; /* Hauteur maximale */
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    z-index: 2;
    transform: translateY(0);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow-y: auto; /* Scroll interne si nécessaire */
}

.form-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}

/* En-tête avec logo compact */
.form-header {
    text-align: center;
    margin-bottom: 1.5rem; /* Marge réduite */
}

.logo {
    height: 50px; /* Logo plus petit */
    margin-bottom: 0.75rem;
}

/* Styles des champs de formulaire compacts */
.form-group {
    margin-bottom: 1rem; /* Espacement réduit */
}

.form-group label {
    font-weight: 600;
    margin-bottom: 0.4rem;
    color: #2d3748;
    font-size: 0.9rem; /* Texte plus compact */
}

.input-group {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease;
}

.input-group:focus-within {
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

.input-group-text {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    padding: 0.6rem 0.8rem; /* Padding réduit */
    min-width: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.form-control {
    border: none;
    padding: 0.6rem; /* Padding réduit */
    font-size: 0.9rem; /* Texte plus petit */
    background: #f8f9fa;
    transition: all 0.3s ease;
}

.form-control:focus {
    background: white;
    outline: none;
}

/* Sélecteur de rôle compact */
.form-select {
    border: none;
    background: #f8f9fa;
    padding: 0.6rem;
    font-size: 0.9rem;
}

.form-select:focus {
    background: white;
    box-shadow: none;
}

/* Bouton d'inscription compact */
.btn-register {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    padding: 0.6rem; /* Padding réduit */
    font-weight: 600;
    font-size: 0.9rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-register:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

/* Messages d'erreur compacts */
.text-error {
    color: #e53e3e;
    font-size: 0.8rem; /* Texte plus petit */
    margin-top: 0.2rem;
    display: block;
}

.text-muted {
    font-size: 0.8rem; /* Texte plus petit */
}

/* Liens */
.form-link {
    color: #667eea;
    text-decoration: none;
    transition: color 0.3s ease;
    font-weight: 600;
    font-size: 0.9rem;
}

.form-link:hover {
    color: #764ba2;
}

/* Indicateur de force du mot de passe compact */
.password-strength {
    height: 3px; /* Barre plus fine */
    background: #e2e8f0;
    border-radius: 2px;
    margin-top: 0.3rem;
    overflow: hidden;
}

.password-strength-bar {
    height: 100%;
    width: 0%;
    background: #e53e3e;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.password-strength.weak .password-strength-bar {
    width: 33%;
    background: #e53e3e;
}

.password-strength.medium .password-strength-bar {
    width: 66%;
    background: #d69e2e;
}

.password-strength.strong .password-strength-bar {
    width: 100%;
    background: #38a169;
}

/* Barre de scroll personnalisée pour le formulaire */
.form-container::-webkit-scrollbar {
    width: 6px;
}

.form-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.form-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.form-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Responsive amélioré */
@media (max-width: 576px) {
    .fullscreen-bg {
        padding: 1rem;
        align-items: flex-start; /* Alignement en haut sur mobile */
    }
    
    .form-container {
        margin: 0;
        padding: 1.5rem;
        max-height: 90vh; /* Hauteur adaptée sur mobile */
    }
    
    .logo {
        height: 40px;
    }
    
    h1.h3 {
        font-size: 1.3rem;
    }
}

@media (max-height: 700px) {
    .form-container {
        max-height: 95vh; /* Plus compact sur les petits écrans */
    }
    
    .form-group {
        margin-bottom: 0.8rem;
    }
}

/* Animation de chargement subtile */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-container {
    animation: fadeInUp 0.5s ease-out;
}
</style>
{% endblock stylesheets %}

{% block content %}
<main class="fullscreen-bg">
    <!-- Livres flottants animés (fixes) -->
    <div class="floating-books" id="floatingBooks"></div>
    
    <div class="form-container">
        <!-- En-tête avec logo -->
        <div class="form-header">
            <img src="/static/assets/img/favicon/homework.png" alt="ArtCollab Logo" class="logo">
            <h1 class="mb-2 h4" style="color: #2d3748;">ArtCollab</h1>
            <p class="text-muted mb-0">
                {% if msg %}
                    <span class="text-error">{{ msg | safe }}</span>
                {% else %}
                    Rejoignez notre communauté créative
                {% endif %}
            </p>
        </div>

        <form method="post" action="" class="mt-3">
            {% csrf_token %}

            <!-- Username -->
            <div class="form-group">
                <label for="username">Nom d'utilisateur</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <span class="fas fa-user-circle"></span>
                    </span>
                    {{ form.username }}
                </div>
                <span class="text-error">{{ form.username.errors }}</span>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="email">Adresse email</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <span class="fas fa-envelope"></span>
                    </span>
                    {{ form.email }}
                </div>
                <span class="text-error">{{ form.email.errors }}</span>
            </div>

            <!-- Rôle -->
            <div class="form-group">
                <label for="role">Votre rôle</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <span class="fas fa-user-tag"></span>
                    </span>
                    {{ form.role }}
                </div>
                {% if form.role.help_text %}
                <small class="form-text text-muted">{{ form.role.help_text }}</small>
                {% endif %}
                <span class="text-error">{{ form.role.errors }}</span>
            </div>

            <!-- Password 1 -->
            <div class="form-group">
                <label for="password1">Mot de passe</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <span class="fas fa-unlock-alt"></span>
                    </span>
                    {{ form.password1 }}
                </div>
                <div class="password-strength" id="passwordStrength">
                    <div class="password-strength-bar"></div>
                </div>
                <span class="text-error">{{ form.password1.errors }}</span>
            </div>

            <!-- Password 2 -->
            <div class="form-group">
                <label for="password2">Confirmation du mot de passe</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <span class="fas fa-lock"></span>
                    </span>
                    {{ form.password2 }}
                </div>
                <span class="text-error">{{ form.password2.errors }}</span>
            </div>

            <!-- Submit -->
            <div class="d-grid mt-3">
                <button type="submit" name="register" class="btn btn-register">Créer mon compte</button>
            </div>
        </form>

        <!-- Lien de connexion -->
        <div class="text-center mt-3 pt-3 border-top">
            <span class="fw-normal text-muted">
                Vous avez déjà un compte ?
                <a href="{% url 'login' %}" class="form-link">Se connecter</a>
            </span>
        </div>
    </div>
</main>
{% endblock content %}

{% block javascripts %}
<script>
// Génération des livres flottants
document.addEventListener('DOMContentLoaded', function() {
    const floatingBooks = document.getElementById('floatingBooks');
    const bookIcons = ['📚', '📖', '📕', '📗', '📘', '📙', '🔖', '📓'];
    
    for (let i = 0; i < 12; i++) { // Moins de livres pour plus de légèreté
        const book = document.createElement('div');
        book.classList.add('book');
        book.innerHTML = bookIcons[Math.floor(Math.random() * bookIcons.length)];
        
        // Position aléatoire
        book.style.left = `${Math.random() * 100}%`;
        
        // Taille aléatoire réduite
        const size = Math.random() * 1.5 + 0.8;
        book.style.fontSize = `${size}rem`;
        
        // Délai d'animation aléatoire
        book.style.animationDelay = `${Math.random() * 20}s`;
        
        // Durée d'animation aléatoire
        book.style.animationDuration = `${15 + Math.random() * 20}s`;
        
        floatingBooks.appendChild(book);
    }
});

// Indicateur de force du mot de passe
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
    const strengthBar = document.querySelector('.password-strength-bar');
    const strengthContainer = document.getElementById('passwordStrength');
    
    if (passwordInput && strengthBar) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            
            // Longueur
            if (password.length >= 8) strength += 1;
            if (password.length >= 12) strength += 1;
            
            // Complexité
            if (/[a-z]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 1;
            
            // Mise à jour de l'indicateur visuel
            strengthContainer.className = 'password-strength';
            if (password.length > 0) {
                if (strength <= 3) {
                    strengthContainer.classList.add('weak');
                } else if (strength <= 5) {
                    strengthContainer.classList.add('medium');
                } else {
                    strengthContainer.classList.add('strong');
                }
            }
        });
    }
    
    // Effet de focus amélioré pour les champs
    const inputs = document.querySelectorAll('.form-control, .form-select');
    
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.2)';
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
        });
    });
});
</script>
{% endblock javascripts %}