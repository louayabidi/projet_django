<p>vcufryxevg  uzbdozbd zduhzbld jezdjlbd nedlbe dneljbd ec hbdeiy ecbe cebc ekhcb kh@login_required</p><p>def badge_create(request):</p><p>&nbsp;&nbsp;if not (hasattr(request.user, 'role') and request.user.role == 'admin'):</p><p>&nbsp;&nbsp;&nbsp;&nbsp;messages.error(request, "Vous n'avez pas la permission de créer des badges.")</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return redirect('badge:badge_list')</p><p>&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;if request.method == 'POST':</p><p>&nbsp;&nbsp;&nbsp;&nbsp;form = BadgeForm(request.POST, request.FILES)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if form.is_valid():</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;badge = form.save()</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# DEBUG : affiche l'objet badge</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print("BADGE CRÉÉ → ID:", badge.id, "| NOM:", badge.nom, "| IMAGE:", badge.image)</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Initialiser pour tous les utilisateurs</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from django.contrib.auth import get_user_model</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User = get_user_model()</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for user in User.objects.all():</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserBadge.objects.get_or_create(user=user, badge=badge)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messages.success(request, f'Le badge "{badge.nom}" a été créé avec succès!')</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect('badge:badge_list')</p><p>&nbsp;&nbsp;else:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;form = BadgeForm()</p><p>&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;return render(request, 'badge/badge_form.html', {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;'form': form,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;'title': 'Créer un badge',</p><p>&nbsp;&nbsp;&nbsp;&nbsp;'segment': 'badge_create'</p><p>&nbsp;&nbsp;})</p>